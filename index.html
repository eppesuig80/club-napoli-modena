<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Firebase DIAGNOSTIC</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',sans-serif;background:#0b1220;color:#e5e7eb;margin:0;padding:24px}
    h1{font-size:22px;margin:0 0 16px}
    .card{background:#111826;border:1px solid #334155;border-radius:12px;padding:16px;max-width:960px}
    .row{margin:8px 0}
    .ok{color:#10b981}
    .bad{color:#f87171}
    code{background:#0b1220;border:1px solid #334155;border-radius:6px;padding:2px 6px}
    pre{white-space:pre-wrap;background:#0b1220;border:1px solid #334155;border-radius:8px;padding:10px;min-height:120px}
    .small{opacity:.8}
  </style>
</head>
<body>
  <h1>Firebase Diagnostic — club-napoli-modena</h1>
  <div class="card">
    <div class="row">Host: <code id="host"></code></div>
    <div class="row">apiKey: <code id="key"></code></div>
    <div class="row">Auth anon: <span id="auth" class="bad">pending…</span></div>
    <div class="row">Firestore write: <span id="fs" class="bad">pending…</span></div>
    <div class="row small">Doc path di test: <code>clubs/diag-write</code></div>
    <h3>Log</h3>
    <pre id="log"></pre>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
  <script>
    const key = "AIzaSyBfBR_YNt-kTFoa-SAFbWk15UoS1a1X03k";
    document.getElementById('host').textContent = location.origin;
    document.getElementById('key').textContent = key;
    const logEl = document.getElementById('log');
    const authEl = document.getElementById('auth');
    const fsEl = document.getElementById('fs');
    function log(msg){ logEl.textContent += msg + "\\n"; }

    try{
      const config = {
        apiKey: key,
        authDomain: "club-napoli-modena.firebaseapp.com",
        projectId: "club-napoli-modena",
        storageBucket: "club-napoli-modena.firebasestorage.app",
        messagingSenderId: "143536134939",
        appId: "1:143536134939:web:8a00860b05a6a916df51be"
      };
      firebase.initializeApp(config);
      log("init: OK");
    }catch(e){
      log("init ERROR: " + (e && e.message ? e.message : e));
    }

    const db = firebase.firestore();
    firebase.auth().signInAnonymously().then(()=>{
      authEl.textContent="OK"; authEl.className='ok';
      log("auth anon: OK");
      return db.collection('clubs').doc('diag-write').set({ts:Date.now(), host:location.origin}, {merge:true});
    }).then(()=>{
      fsEl.textContent="OK"; fsEl.className='ok';
      log("firestore write: OK");
    }).catch(err=>{
      const msg = (err && err.message ? err.message : String(err||''));
      log("ERROR: " + msg);
      if(err && err.code) log("err.code=" + err.code);
      if(/api.?key/i.test(msg)){ authEl.textContent="ERRORE KEY"; authEl.className='bad'; }
      if(/permission|denied/i.test(msg)){ fsEl.textContent="PERMISSION DENIED"; fsEl.className='bad'; }
    });
  </script>
</body>
</html>
