<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CLUB NAPOLI PARTENPEI — Gestione Soci (Offline)</title>
<style>
  :root{
    --bg:#0f172a;
    --card:#111c3a;
    --muted:#9aa6c6;
    --text:#e6edff;
    --accent:#60a5fa;
    --accent-2:#fbbf24;
    --danger:#ef4444;
    --ok:#22c55e;
    --chip:#1f2a4a;
    --border:#223063;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    background: radial-gradient(1200px 700px at 80% -10%, #1e293b88 0%, transparent 60%), var(--bg);
    color:var(--text);
  }
  header{
    display:flex; align-items:center; gap:16px;
    padding:28px 24px 8px 24px;
  }
  .logo{
    width:72px; height:72px; border-radius:50%;
    background:#0b1229 center/cover no-repeat;
    border:2px solid var(--border);
    overflow:hidden;
    flex:0 0 auto;
  }
  .logo img{width:100%; height:100%; object-fit:cover}
  h1{font-size: clamp(22px, 4.2vw, 42px); margin:0; letter-spacing:.5px}
  .status{
    margin-left:auto; font-size:12px; background:var(--chip); padding:6px 10px; border-radius:999px; border:1px solid var(--border);
  }
  .wrap{max-width:1200px; margin:0 auto; padding:0 16px 40px}
  .toolbar{
    display:flex; flex-wrap:wrap; gap:12px; padding:16px 8px 24px 8px;
  }
  button, .btn{
    background:#0b1631; color:var(--text); border:1px solid var(--border);
    padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600;
    transition:.2s ease; font-size:14px;
  }
  button:hover, .btn:hover{transform: translateY(-1px); border-color:#3656a8}
  .btn-gold{ background:#3c2e07; border-color:#5a4510}
  .btn-danger{ background:#2b1112; border-color:#5d1b1f; color:#fecaca}
  .btn-primary{ background:#0c2345; border-color:#16407a}
  .btn-outline{ background:#0a122a}
  .card{ background:linear-gradient(180deg,#101a36, #0e1832); border:1px solid var(--border); border-radius:18px; padding:18px; box-shadow:0 10px 30px #0004}
  .grid{ display:grid; gap:14px; grid-template-columns: repeat(12, 1fr)}
  .col-3{ grid-column: span 3}
  .col-4{ grid-column: span 4}
  .col-6{ grid-column: span 6}
  .col-12{ grid-column: span 12}
  @media(max-width:980px){
    .col-3,.col-4,.col-6{ grid-column: span 12}
  }
  label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
  input, select{
    width:100%; background:#0a1228; border:1px solid var(--border); color:var(--text);
    border-radius:12px; padding:12px 12px; font-size:15px; outline:none;
  }
  input:focus, select:focus{ border-color:#476bda; box-shadow:0 0 0 3px #476bda33}
  .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:8px}
  .list-head{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:18px}
  .search{ flex:1 }
  .table{ width:100%; border-collapse:collapse; margin-top:12px; overflow:hidden; border-radius:14px; border:1px solid var(--border)}
  .table thead{ background:#102046; color:#cfe1ff}
  .table th, .table td{ padding:10px 12px; border-bottom:1px solid var(--border); text-align:left; font-size:14px}
  .chip{ font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); background:var(--chip)}
  .muted{ color:var(--muted)}
  .right{ text-align:right}
  .flex{display:flex; gap:10px; align-items:center}
  footer{opacity:.7; font-size:12px; padding:18px 6px; text-align:center}
  .hidden{display:none}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" id="logoPreview" title="Logo club"></div>
      <div>
        <h1>CLUB NAPOLI PARTENPEI</h1>
        <div class="muted">Inserimento Dati — Modalità <span class="chip">OFFLINE</span></div>
      </div>
      <div class="status">Nessun server • dati salvati sul dispositivo</div>
    </header>

    <div class="toolbar">
      <label for="logoInput" class="btn btn-outline">Carica Logo</label>
      <input type="file" id="logoInput" accept="image/*" class="hidden"/>
      <button class="btn btn-primary" id="btnExportJSON">Esporta JSON</button>
      <label for="importJSON" class="btn btn-gold">Importa JSON</label>
      <input type="file" id="importJSON" accept="application/json" class="hidden"/>
      <button class="btn btn-outline" id="btnExportPDF">Esporta Soci (PDF)</button>
      <button class="btn btn-danger" id="btnClearAll">Svuota tutto</button>
    </div>

    <section class="card">
      <h2 style="margin:0 0 14px">Modulo iscrizione — Soci</h2>
      <div class="grid">
        <div class="col-6">
          <label>Nome</label>
          <input id="f_nome" placeholder="Nome"/>
        </div>
        <div class="col-6">
          <label>Cogome</label>
          <input id="f_cognome" placeholder="Cognome"/>
        </div>

        <div class="col-4">
          <label>Luogo di nascita (Comune)</label>
          <input id="f_luogo" placeholder="Comune"/>
        </div>
        <div class="col-2">
          <label>PRO</label>
          <input id="f_pro" maxlength="2" placeholder="PR"/>
        </div>
        <div class="col-4">
          <label>Residenza (Comune)</label>
          <input id="f_residenza" placeholder="Comune"/>
        </div>
        <div class="col-2">
          <label>PRO</label>
          <input id="f_res_pro" maxlength="2" placeholder="PR"/>
        </div>

        <div class="col-4">
          <label>N° Tessera</label>
          <input id="f_tessera" placeholder="0000"/>
        </div>
        <div class="col-4">
          <label>CF</label>
          <input id="f_cf" placeholder="Codice Fiscale"/>
        </div>
        <div class="col-2">
          <label>Sesso</label>
          <select id="f_sesso">
            <option value="M">M</option>
            <option value="F">F</option>
            <option value="Altro">Altro</option>
          </select>
        </div>
        <div class="col-2">
          <label>Data</label>
          <input id="f_data" type="date"/>
        </div>
        <div class="col-12 actions">
          <button id="btnAdd" class="btn btn-primary">Aggiungi / Salva</button>
          <button id="btnReset" class="btn btn-outline">Pulisci</button>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <div class="list-head">
        <div class="muted">Elenco soci</div>
        <input id="search" class="search" placeholder="Cerca per cognome/nome/CF (min 3 lettere)"/>
      </div>
      <table class="table" id="tbl">
        <thead>
          <tr>
            <th>#</th><th>Nome</th><th>Cognome</th><th>Comune nascita</th><th>PR</th>
            <th>Residenza</th><th>PR</th><th>Tessera</th><th>CF</th><th>Sesso</th><th>Data</th><th class="right">Azioni</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <footer>© Club Napoli Partenpei — versione offline (LocalStorage). Dati solo sul tuo dispositivo.</footer>
  </div>

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
(() => {
  const LS_KEY = 'sociData_v1';
  const LS_LOGO = 'clubLogo_v1';
  const $ = (id) => document.getElementById(id);
  const by = (sel, root=document) => root.querySelector(sel);
  let editingIndex = null;

  const state = {
    items: []
  };

  function load() {
    try {
      const raw = localStorage.getItem(LS_KEY);
      if (raw) state.items = JSON.parse(raw);
    } catch(e){ console.warn('load fail', e); }
    render();
    // logo
    const logo = localStorage.getItem(LS_LOGO);
    if (logo) setLogo(logo);
  }

  function save() {
    localStorage.setItem(LS_KEY, JSON.stringify(state.items));
  }

  function setLogo(dataUrl){
    const box = $('logoPreview');
    box.innerHTML = '<img alt="logo club" src="'+dataUrl+'"/>';
  }

  function addOrSave() {
    const m = {
      nome: $('f_nome').value.trim(),
      cognome: $('f_cognome').value.trim(),
      luogo: $('f_luogo').value.trim(),
      pro: $('f_pro').value.trim().toUpperCase(),
      residenza: $('f_residenza').value.trim(),
      res_pro: $('f_res_pro').value.trim().toUpperCase(),
      tessera: $('f_tessera').value.trim(),
      cf: $('f_cf').value.trim().toUpperCase(),
      sesso: $('f_sesso').value,
      data: $('f_data').value
    };
    if (!m.nome || !m.cognome){ alert('Nome e Cognome sono obbligatori'); return; }
    if (editingIndex===null){
      state.items.push(m);
    } else {
      state.items[editingIndex] = m;
      editingIndex = null;
      $('btnAdd').textContent = 'Aggiungi / Salva';
    }
    save();
    render();
    resetForm();
  }

  function resetForm(){
    for (const id of ['f_nome','f_cognome','f_luogo','f_pro','f_residenza','f_res_pro','f_tessera','f_cf','f_data']){
      $(id).value = '';
    }
    $('f_sesso').value = 'M';
    editingIndex = null;
    $('btnAdd').textContent = 'Aggiungi / Salva';
  }

  function render(filter=''){
    const tbody = by('#tbl tbody');
    tbody.innerHTML = '';
    let data = state.items;
    const q = filter.trim().toLowerCase();
    if (q.length>=3){
      data = data.filter(x =>
        (x.nome||'').toLowerCase().includes(q) ||
        (x.cognome||'').toLowerCase().includes(q) ||
        (x.cf||'').toLowerCase().includes(q)
      );
    }
    data.forEach((x, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${idx+1}</td>
        <td>${escapeHtml(x.nome)}</td>
        <td>${escapeHtml(x.cognome)}</td>
        <td>${escapeHtml(x.luogo)}</td>
        <td>${escapeHtml(x.pro)}</td>
        <td>${escapeHtml(x.residenza)}</td>
        <td>${escapeHtml(x.res_pro)}</td>
        <td>${escapeHtml(x.tessera)}</td>
        <td>${escapeHtml(x.cf)}</td>
        <td>${escapeHtml(x.sesso)}</td>
        <td>${formatDate(x.data)}</td>
        <td class="right">
          <button class="btn btn-outline" data-act="edit" data-i="${idx}">Modifica</button>
          <button class="btn btn-danger" data-act="del" data-i="${idx}">Elimina</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  function formatDate(str){
    if (!str) return '';
    try{
      const d = new Date(str);
      return d.toLocaleDateString('it-IT');
    }catch{ return str; }
  }

  function escapeHtml(s){
    return (s || '').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
  }

  // events
  $('btnAdd').addEventListener('click', addOrSave);
  $('btnReset').addEventListener('click', resetForm);
  $('search').addEventListener('input', e => render(e.target.value));

  by('#tbl tbody').addEventListener('click', (e)=>{
    const btn = e.target.closest('button');
    if (!btn) return;
    const i = parseInt(btn.dataset.i,10);
    if (btn.dataset.act === 'del'){
      if (confirm('Eliminare questo socio?')){
        state.items.splice(i,1);
        save(); render($('search').value);
      }
    } else if (btn.dataset.act === 'edit'){
      const x = state.items[i];
      editingIndex = i;
      $('f_nome').value = x.nome||'';
      $('f_cognome').value = x.cognome||'';
      $('f_luogo').value = x.luogo||'';
      $('f_pro').value = x.pro||'';
      $('f_residenza').value = x.residenza||'';
      $('f_res_pro').value = x.res_pro||'';
      $('f_tessera').value = x.tessera||'';
      $('f_cf').value = x.cf||'';
      $('f_sesso').value = x.sesso||'M';
      $('f_data').value = x.data||'';
      $('btnAdd').textContent = 'Salva modifiche';
      window.scrollTo({top:0, behavior:'smooth'});
    }
  });

  // file: export/import JSON
  $('btnExportJSON').addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(state.items, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'soci.json';
    a.click();
    URL.revokeObjectURL(a.href);
  });

  $('importJSON').addEventListener('change', async (e)=>{
    const file = e.target.files[0];
    if (!file) return;
    try{
      const text = await file.text();
      const arr = JSON.parse(text);
      if (!Array.isArray(arr)) throw new Error('Formato non valido');
      state.items = arr;
      save(); render($('search').value);
      alert('Import completato.');
    }catch(err){
      alert('Import fallito: ' + err.message);
    } finally {
      e.target.value = '';
    }
  });

  // PDF
  $('btnExportPDF').addEventListener('click', ()=>{
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({unit:'pt', format:'a4'});
    const margin = 40;
    let y = margin;
    doc.setFont('helvetica','bold'); doc.setFontSize(16);
    doc.text('Elenco Soci — Club Napoli Partenpei', margin, y);
    y += 18;
    doc.setFont('helvetica',''); doc.setFontSize(11);
    const now = new Date().toLocaleString('it-IT');
    doc.text('Data esportazione: ' + now, margin, y);
    y += 20;
    // table header
    doc.setFont('helvetica','bold');
    const headers = ['#','Nome','Cognome','Comune','PR','Res.','PR','Tessera','CF','Sesso','Data'];
    const widths = [18,70,80,80,24,80,24,52,110,40,60];
    let x = margin;
    headers.forEach((h,i)=>{ doc.text(h, x, y); x += widths[i]; });
    y += 14; doc.setFont('helvetica',''); doc.setFontSize(10);
    const data = state.items;
    data.forEach((r, idx)=>{
      x = margin;
      const row = [
        String(idx+1),
        r.nome||'', r.cognome||'',
        r.luogo||'', r.pro||'',
        r.residenza||'', r.res_pro||'',
        r.tessera||'', r.cf||'', r.sesso||'',
        r.data ? new Date(r.data).toLocaleDateString('it-IT') : ''
      ];
      row.forEach((cell,i)=>{
        const txt = String(cell);
        doc.text(txt.length>28 ? txt.slice(0,27)+'…' : txt, x, y);
        x += widths[i];
      });
      y += 14;
      if (y > 800){ doc.addPage(); y = margin; }
    });
    doc.save('soci.pdf');
  });

  // logo
  $('logoInput').addEventListener('change', (e)=>{
    const f = e.target.files[0];
    if (!f) return;
    const reader = new FileReader();
    reader.onload = () => {
      const dataUrl = reader.result;
      setLogo(dataUrl);
      localStorage.setItem(LS_LOGO, dataUrl);
    };
    reader.readAsDataURL(f);
  });

  // clear all
  $('btnClearAll').addEventListener('click', ()=>{
    if (!confirm('Sicuro di cancellare TUTTO?')) return;
    localStorage.removeItem(LS_KEY);
    localStorage.removeItem(LS_LOGO);
    state.items = [];
    render(); setLogo('');
  });

  load();
})();
</script>
</body>
</html>
